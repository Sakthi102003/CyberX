<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment PDF Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .error {
            color: #dc3545;
        }
        .success {
            color: #28a745;
        }
        .info {
            color: #17a2b8;
        }
        .warning {
            color: #ffc107;
        }
        .url-display {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            word-break: break-all;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
        .status-info { background-color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìÑ Deployment PDF Test Suite</h1>
        <p>This comprehensive test will help diagnose PDF access issues in your deployed application.</p>
        
        <div class="test-section">
            <h3>üåê Environment Information</h3>
            <div id="env-info"></div>
        </div>
        
        <div class="test-section">
            <h3>üîó URL Tests</h3>
            <button onclick="testAllUrls()">Test All PDF URLs</button>
            <button onclick="testHeaders()">Test Response Headers</button>
            <div id="url-results"></div>
        </div>
        
        <div class="test-section">
            <h3>üì• Download Tests</h3>
            <button onclick="testBlobDownload()">Test Blob Download</button>
            <button onclick="testLinkDownload()">Test Link Download</button>
            <button onclick="testDirectDownload()">Test Direct Download</button>
        </div>
        
        <div class="test-section">
            <h3>üëÅÔ∏è Preview Tests</h3>
            <button onclick="testNewTabPreview()">Test New Tab Preview</button>
            <button onclick="testEmbeddedPreview()">Test Embedded Preview</button>
        </div>
        
        <div class="test-section">
            <h3>üéØ Manual Tests</h3>
            <p>Try these manual tests:</p>
            <a href="/resume.pdf" target="_blank">üìÑ Direct PDF Link</a><br>
            <a href="./resume.pdf" target="_blank">üìÑ Relative PDF Link</a><br>
            <a href="/resume.pdf" download="resume.pdf">üíæ Download Link</a><br>
            <a href="data:text/plain;base64,SGVsbG8gV29ybGQ=" download="test.txt">üß™ Test Download (Base64)</a>
        </div>
        
        <button onclick="runAllTests()" style="background-color: #28a745; font-size: 16px; padding: 15px 30px;">
            üöÄ Run All Tests
        </button>
        <button onclick="clearLog()" style="background-color: #6c757d;">
            üóëÔ∏è Clear Log
        </button>
        
        <div id="log" class="log"></div>
        
        <div class="test-section">
            <h3>üìä Results Summary</h3>
            <div id="results-summary"></div>
        </div>
    </div>

    <script>
        let testResults = {
            passed: 0,
            failed: 0,
            warnings: 0,
            total: 0
        };

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : 
                            type === 'success' ? 'success' : 
                            type === 'warning' ? 'warning' : 'info';
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            testResults = { passed: 0, failed: 0, warnings: 0, total: 0 };
            updateResultsSummary();
        }

        function updateResultsSummary() {
            const summaryDiv = document.getElementById('results-summary');
            summaryDiv.innerHTML = `
                <div>
                    <span class="status-indicator status-success"></span>
                    Passed: ${testResults.passed}
                </div>
                <div>
                    <span class="status-indicator status-error"></span>
                    Failed: ${testResults.failed}
                </div>
                <div>
                    <span class="status-indicator status-warning"></span>
                    Warnings: ${testResults.warnings}
                </div>
                <div>
                    <span class="status-indicator status-info"></span>
                    Total: ${testResults.total}
                </div>
            `;
        }

        function recordResult(success, warning = false) {
            testResults.total++;
            if (success) {
                if (warning) {
                    testResults.warnings++;
                } else {
                    testResults.passed++;
                }
            } else {
                testResults.failed++;
            }
            updateResultsSummary();
        }

        function displayEnvironmentInfo() {
            const envDiv = document.getElementById('env-info');
            const info = {
                'Current URL': window.location.href,
                'Origin': window.location.origin,
                'Protocol': window.location.protocol,
                'Host': window.location.host,
                'User Agent': navigator.userAgent,
                'Cookies Enabled': navigator.cookieEnabled,
                'Online Status': navigator.onLine,
                'Screen Resolution': `${screen.width}x${screen.height}`,
                'Viewport': `${window.innerWidth}x${window.innerHeight}`
            };
            
            let html = '<table style="width: 100%; border-collapse: collapse;">';
            for (const [key, value] of Object.entries(info)) {
                html += `<tr><td style="padding: 8px; border-bottom: 1px solid #ddd; font-weight: bold;">${key}:</td><td style="padding: 8px; border-bottom: 1px solid #ddd; word-break: break-all;">${value}</td></tr>`;
            }
            html += '</table>';
            envDiv.innerHTML = html;
        }

        async function testAllUrls() {
            log('üîç Testing all PDF URL variations...', 'info');
            
            const baseUrl = window.location.origin;
            const urls = [
                `${baseUrl}/resume.pdf`,
                `${baseUrl}/resume.pdf`,
                `./resume.pdf`,
                `/resume.pdf`,
                `${window.location.href.replace(/\/[^\/]*$/, '')}/resume.pdf`
            ];
            
            for (const url of urls) {
                try {
                    log(`Testing URL: ${url}`, 'info');
                    const response = await fetch(url, { method: 'HEAD' });
                    
                    if (response.ok) {
                        log(`‚úÖ URL accessible: ${url} (${response.status})`, 'success');
                        recordResult(true);
                    } else {
                        log(`‚ùå URL failed: ${url} (${response.status} ${response.statusText})`, 'error');
                        recordResult(false);
                    }
                } catch (error) {
                    log(`‚ùå URL error: ${url} - ${error.message}`, 'error');
                    recordResult(false);
                }
            }
        }

        async function testHeaders() {
            log('üìã Testing response headers...', 'info');
            
            const baseUrl = window.location.origin;
            const url = `${baseUrl}/resume.pdf`;
            
            try {
                const response = await fetch(url, { method: 'HEAD' });
                
                if (response.ok) {
                    log(`Headers for ${url}:`, 'info');
                    for (const [key, value] of response.headers.entries()) {
                        log(`  ${key}: ${value}`, 'info');
                    }
                    recordResult(true);
                } else {
                    log(`‚ùå Failed to get headers: ${response.status} ${response.statusText}`, 'error');
                    recordResult(false);
                }
            } catch (error) {
                log(`‚ùå Header test error: ${error.message}`, 'error');
                recordResult(false);
            }
        }

        async function testBlobDownload() {
            log('üîÑ Testing blob-based download...', 'info');
            
            const baseUrl = window.location.origin;
            const url = `${baseUrl}/resume.pdf`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const blob = await response.blob();
                log(`üìä Blob created: ${blob.size} bytes, type: ${blob.type}`, 'info');
                
                const pdfBlob = new Blob([blob], { type: 'application/pdf' });
                const blobUrl = URL.createObjectURL(pdfBlob);
                
                const link = document.createElement('a');
                link.href = blobUrl;
                link.download = 'test-blob-download.pdf';
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                URL.revokeObjectURL(blobUrl);
                
                log('‚úÖ Blob download initiated successfully', 'success');
                recordResult(true);
                
            } catch (error) {
                log(`‚ùå Blob download failed: ${error.message}`, 'error');
                recordResult(false);
            }
        }

        async function testLinkDownload() {
            log('üîó Testing link-based download...', 'info');
            
            const baseUrl = window.location.origin;
            const url = `${baseUrl}/resume.pdf`;
            
            try {
                const link = document.createElement('a');
                link.href = url;
                link.download = 'test-link-download.pdf';
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                log('‚úÖ Link download initiated successfully', 'success');
                recordResult(true);
                
            } catch (error) {
                log(`‚ùå Link download failed: ${error.message}`, 'error');
                recordResult(false);
            }
        }

        async function testDirectDownload() {
            log('üì• Testing direct download...', 'info');
            
            const baseUrl = window.location.origin;
            const url = `${baseUrl}/resume.pdf`;
            
            try {
                window.location.href = url;
                log('‚úÖ Direct download initiated', 'success');
                recordResult(true);
                
            } catch (error) {
                log(`‚ùå Direct download failed: ${error.message}`, 'error');
                recordResult(false);
            }
        }

        async function testNewTabPreview() {
            log('ü™ü Testing new tab preview...', 'info');
            
            const baseUrl = window.location.origin;
            const url = `${baseUrl}/resume.pdf`;
            
            try {
                const newWindow = window.open(url, '_blank');
                if (newWindow) {
                    log('‚úÖ New tab opened successfully', 'success');
                    recordResult(true);
                } else {
                    log('‚ö†Ô∏è New tab blocked by popup blocker', 'warning');
                    recordResult(true, true);
                }
            } catch (error) {
                log(`‚ùå New tab preview failed: ${error.message}`, 'error');
                recordResult(false);
            }
        }

        async function testEmbeddedPreview() {
            log('üñºÔ∏è Testing embedded preview...', 'info');
            
            const baseUrl = window.location.origin;
            const url = `${baseUrl}/resume.pdf`;
            
            try {
                const iframe = document.createElement('iframe');
                iframe.src = url;
                iframe.style.width = '100%';
                iframe.style.height = '500px';
                iframe.style.border = '1px solid #ddd';
                iframe.style.marginTop = '20px';
                
                iframe.onload = () => {
                    log('‚úÖ Embedded preview loaded successfully', 'success');
                    recordResult(true);
                };
                
                iframe.onerror = () => {
                    log('‚ùå Embedded preview failed to load', 'error');
                    recordResult(false);
                };
                
                document.body.appendChild(iframe);
                
                // Remove iframe after test
                setTimeout(() => {
                    document.body.removeChild(iframe);
                }, 5000);
                
            } catch (error) {
                log(`‚ùå Embedded preview error: ${error.message}`, 'error');
                recordResult(false);
            }
        }

        async function runAllTests() {
            log('üöÄ Starting comprehensive PDF test suite...', 'info');
            clearLog();
            
            displayEnvironmentInfo();
            
            await testAllUrls();
            await testHeaders();
            await testBlobDownload();
            await testLinkDownload();
            await testNewTabPreview();
            await testEmbeddedPreview();
            
            log('‚úÖ All tests completed!', 'success');
            
            const successRate = (testResults.passed / testResults.total * 100).toFixed(1);
            log(`üìä Success rate: ${successRate}% (${testResults.passed}/${testResults.total})`, 'info');
            
            if (testResults.failed > 0) {
                log('‚ùå Some tests failed. Check the logs above for details.', 'error');
            } else if (testResults.warnings > 0) {
                log('‚ö†Ô∏è All tests passed, but some warnings were generated.', 'warning');
            } else {
                log('üéâ All tests passed successfully!', 'success');
            }
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            displayEnvironmentInfo();
            log('üìÑ PDF Test Suite loaded. Click "Run All Tests" to begin.', 'info');
        });
    </script>
</body>
</html>
